<% content_for :breadcrumbs do %>
  <%= render(BreadcrumbsComponent.new) do |c| %>
    <%= c.item href: procurement_orders_path do %>Orders<% end %>
    <%= c.item href: procurement_order_path(@order) do %><%= @order.number %><% end %>
  <% end %>
<% end %>

<div class="max-w-5xl mx-auto px-4 sm:px-6 md:px-8">
  <% if @order.discarded? %>
    <div class="bg-red-50 border-l-4 border-red-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <%= heroicon 'trash', variant: :solid, options: { class: 'h-5 w-5 text-red-400' } %>
        </div>
        <div class="ml-3">
          <p class="text-sm text-red-700">
            This order is in the trash.
          </p>
        </div>
      </div>
    </div>
  <% elsif @order.delivered? %>
    <div class="bg-indigo-50 border-l-4 border-indigo-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <%= heroicon 'truck', variant: :solid, options: { class: 'h-5 w-5 text-indigo-400' } %>
        </div>
        <div class="ml-3">
          <p class="text-sm text-indigo-700">
            This order was delivered <%= local_time @order.delivered_at, format: :long %>.
          </p>
        </div>
      </div>
    </div>
  <% elsif @order.available? %>
    <div class="max-w-3xl">
      <p class="mt-2 text-4xl font-extrabold tracking-tight sm:text-5xl">Available</p>
      <p class="mt-2 text-base text-gray-500">Order #<%= @order.number %> is currently waiting for a supplier.</p>

      <% if policy(@order).update? %>
        <div class="mt-12 flex max-w-md">
          <%= render 'redraft_modal', order: @order %>
          <%= render 'cancel_modal', order: @order %>
        </div>
      <% end %>
    </div>
  <% elsif @order.in_progress? && policy(@order).update? %>
    <div class="max-w-3xl">
      <p class="mt-2 text-4xl font-extrabold tracking-tight sm:text-5xl">It's on the way!</p>
      <p class="mt-2 text-base text-gray-500">Your order #<%= @order.number %> has been accepted by <span class="font-medium"><%= @order.supplier_name %></span> and will be with you soon.</p>
      <p class="mt-2 text-base text-gray-500">Keep an eye out in your contracts and mark the order as delivered below once you've accepted the contract.</dt>

      <!--
      <dl class="mt-12 text-sm font-medium">
        <dt class="text-gray-900">Tracking number</dt>
        <dd class="text-indigo-600 mt-2"><%= @order.tracking_number %></dd>
      </dl>
      -->
    </div>
  <% elsif @order.in_progress? && current_user.character == @order.supplier %>
    <div class="max-w-3xl">
      <p class="mt-2 text-4xl font-extrabold tracking-tight sm:text-5xl">Order accepted.</p>
      <p class="mt-2 text-base text-gray-500">
        You have agreed to supply order #<%= @order.number %>.
        Once you've completed the order, create an item exchange contract to <span class="font-medium text-gray-900"><%= @order.requester.is_a?(Alliance) ? @order.requester.procurement_order_requester.name : @order.requester_name %></span>
        at <span class="font-medium text-gray-900"><%= @order.location_name %></span>
        for <span class="font-medium text-gray-900"><%= number_to_isk @order.total %> ISK</span>
        with <span class="font-medium text-gray-900"><%= @order.tracking_number %></span> as the contract description.
      </p>

      <!--
      <dl class="mt-12 text-sm font-medium">
        <dt class="text-gray-900">Tracking number</dt>
        <dd class="text-indigo-600 mt-2"><%= @order.tracking_number %></dd>
      </dl>
      -->
    </div>
  <% end %>

  <div class="mt-8 px-4 space-y-2 sm:px-0 sm:flex sm:items-center sm:justify-between sm:space-y-0">
    <div>
      <h1 class="text-lg font-extrabold tracking-tight text-gray-900 sm:text-lg block">Order <%= @order.number %></h1>
      <p class="text-xs text-gray-600 block">Updated <%= local_time @order.updated_at, class: 'font-medium text-gray-900', format: :long_date %></p>
    </div>
    <div>
      <% render('delete_modal', order: @order) if @order.draft? && @order.kept? && policy(@order).destroy? %>
    </div>
  </div>

  <% if @order.draft? && policy(@order).update? %>
    <div class="bg-white shadow sm:rounded-lg mt-4">
      <div class="px-4 py-5 sm:px-6">
        <%= render 'order_form', order: @order %>
      </div>
    </div>
  <% else %>
    <%= render 'order_summary', order: @order %>
  <% end %>
</div>
