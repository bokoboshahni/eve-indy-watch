<% content_for :breadcrumbs do %>
  <%= render(BreadcrumbsComponent.new) do |c| %>
    <%= c.item href: procurement_orders_path do %>Orders<% end %>
    <%= c.item href: procurement_order_path(@order) do %><%= @order.number %><% end %>
  <% end %>
<% end %>

<div class="max-w-5xl mx-auto px-4 sm:px-6 md:px-8">
  <% if @order.discarded? %>
    <div class="bg-red-50 border-l-4 border-red-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <%= heroicon 'trash', variant: :solid, options: { class: 'h-5 w-5 text-red-400' } %>
        </div>
        <div class="ml-3">
          <p class="text-sm text-red-700">
            This order is in the trash.
          </p>
        </div>
      </div>
    </div>
  <% elsif @order.delivered? %>
    <div class="bg-indigo-50 border-l-4 border-indigo-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <%= heroicon 'truck', variant: :solid, options: { class: 'h-5 w-5 text-indigo-400' } %>
        </div>
        <div class="ml-3">
          <p class="text-sm text-indigo-700">
            This order was delivered <%= local_time @order.delivered_at, format: :long %>.
          </p>
        </div>
      </div>
    </div>
  <% elsif @order.available? %>
    <div class="max-w-3xl">
      <p class="mt-2 text-4xl font-extrabold tracking-tight sm:text-5xl">Available</p>
      <p class="mt-2 text-base text-gray-500">Order #<%= @order.number %> is currently waiting for a supplier.</p>

      <% if policy(@order).update? %>
        <div class="mt-12 flex max-w-md">
          <div class="grow" data-controller="modal" data-modal-allow-background-close="false">
            <%= button_to redraft_procurement_order_path(@order), class: 'w-full bg-indigo-600 border border-transparent rounded-md shadow-sm py-2 px-3 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-indigo-500', data: { action: 'click->modal#open' } do %>
              Edit Order
            <% end %>

            <div data-modal-target="container" data-action="click->modal#closeBackground keyup@window->modal#closeWithKeyboard" class="hidden animated fadeIn fixed z-10 inset-0 overflow-y-auto" style="z-index: 9999;">
              <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                      <%= heroicon 'check', variant: :outline, options: { class: 'h-6 w-6 text-green-600' } %>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                      <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                        Edit Order
                      </h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">
                          Are you sure you want to edit this order? Editing the order will move it back to draft status and make it unavailable to suppliers until it is published again.
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <%= button_to redraft_procurement_order_path(@order), class: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm', data: { turbo_frame: '_top' } do %>
                      Edit order
                    <% end %>
                    <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm" data-action="click->modal#close">
                      Nevermind
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="ml-3 grow" data-controller="modal" data-modal-allow-background-close="false">
            <%= button_to procurement_order_path(@order), method: :delete, class: 'w-full bg-red-600 border border-transparent rounded-md shadow-sm py-2 px-3 text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-red-500', data: { action: 'click->modal#open' } do %>
              Cancel Order
            <% end %>

            <div data-modal-target="container" data-action="click->modal#closeBackground keyup@window->modal#closeWithKeyboard" class="hidden animated fadeIn fixed z-10 inset-0 overflow-y-auto" style="z-index: 9999;">
              <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <%= heroicon 'exclamation', variant: :outline, options: { class: 'h-6 w-6 text-red-600' } %>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                      <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                        Cancel Order
                      </h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">
                          Are you sure you want to cancel this order? This action cannot be undone.
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <%= button_to procurement_order_path(@order), method: :delete, class: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm', data: { turbo_frame: '_top' } do %>
                      Cancel order
                    <% end %>
                    <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm" data-action="click->modal#close">
                      Nevermind
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% elsif @order.in_progress? && policy(@order).update? %>
    <div class="max-w-3xl">
      <p class="mt-2 text-4xl font-extrabold tracking-tight sm:text-5xl">It's on the way!</p>
      <p class="mt-2 text-base text-gray-500">Your order #<%= @order.number %> has been accepted by <span class="font-medium"><%= @order.supplier_name %></span> and will be with you soon.</p>
      <p class="mt-2 text-base text-gray-500">Keep an eye out in your contracts and mark the order as delivered below once you've accepted the contract.</dt>

      <!--
      <dl class="mt-12 text-sm font-medium">
        <dt class="text-gray-900">Tracking number</dt>
        <dd class="text-indigo-600 mt-2"><%= @order.tracking_number %></dd>
      </dl>
      -->
    </div>
  <% elsif @order.in_progress? && current_user.character == @order.supplier %>
    <div class="max-w-3xl">
      <p class="mt-2 text-4xl font-extrabold tracking-tight sm:text-5xl">Order accepted.</p>
      <p class="mt-2 text-base text-gray-500">You have agreed to supply order #<%= @order.number %>. Once you've completed the order, create an item exchange contract to <span class="font-medium text-gray-900"><%= @order.requester_name %></span> at <span class="font-medium text-gray-900"><%= @order.location_name %></span> for <span class="font-medium text-gray-900"><%= number_to_isk @order.total %> ISK</span> with <span class="font-medium text-gray-900"><%= @order.tracking_number %></span> as the contract description.</p>

      <!--
      <dl class="mt-12 text-sm font-medium">
        <dt class="text-gray-900">Tracking number</dt>
        <dd class="text-indigo-600 mt-2"><%= @order.tracking_number %></dd>
      </dl>
      -->
    </div>
  <% end %>

  <div class="mt-8 px-4 space-y-2 sm:px-0 sm:flex sm:items-center sm:justify-between sm:space-y-0">
    <div>
      <h1 class="text-lg font-extrabold tracking-tight text-gray-900 sm:text-lg block">Order <%= @order.number %></h1>
      <p class="text-xs text-gray-600 block">Updated <%= local_time @order.updated_at, class: 'font-medium text-gray-900', format: :long_date %></p>
    </div>
    <div>
      <% if @order.draft? && @order.kept? && policy(@order).destroy? %>
        <div class="ml-3" data-controller="modal" data-modal-allow-background-close="false">
          <%= button_to procurement_order_path(@order), method: :delete, class: 'w-full bg-red-600 border border-transparent rounded-md shadow-sm py-2 px-3 text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-red-500', data: { action: 'click->modal#open' } do %>
            Delete
          <% end %>

          <div data-modal-target="container" data-action="click->modal#closeBackground keyup@window->modal#closeWithKeyboard" class="hidden animated fadeIn fixed z-10 inset-0 overflow-y-auto" style="z-index: 9999;">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
              <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

              <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

              <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div class="sm:flex sm:items-start">
                  <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                    <%= heroicon 'exclamation', variant: :outline, options: { class: 'h-6 w-6 text-red-600' } %>
                  </div>
                  <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                    <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                      Delete Order
                    </h3>
                    <div class="mt-2">
                      <p class="text-sm text-gray-500">
                        Are you sure you want to delete this order? This action cannot be undone.
                      </p>
                    </div>
                  </div>
                </div>
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                  <%= button_to procurement_order_path(@order), method: :delete, class: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm', data: { turbo_frame: '_top' } do %>
                    Delete order
                  <% end %>
                  <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm" data-action="click->modal#close">
                    Nevermind
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>


    </div>
  </div>

  <% if @order.draft? && policy(@order).update? %>
    <div class="bg-white shadow sm:rounded-lg mt-4">
      <div class="px-4 py-5 sm:px-6">
        <%= render 'order_form', order: @order %>
      </div>
    </div>
  <% else %>
    <%= render 'order_summary', order: @order %>
  <% end %>
</div>
